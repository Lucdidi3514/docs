---
title: 'D√©ploiement Netlify'
description: 'Configuration et d√©ploiement sur Netlify'
---

## Pr√©requis

<Check>Compte Netlify cr√©√© ([S'inscrire](https://app.netlify.com/signup))</Check>
<Check>Repository Git configur√© (GitHub, GitLab, Bitbucket)</Check>
<Check>Build de production fonctionnel localement</Check>
<Check>Variables d'environnement Supabase pr√™tes</Check>

---

## Configuration du projet

### Fichier `netlify.toml`

Cr√©ez ce fichier √† la racine du projet :

```toml
[build]
  command = "npm run build"
  publish = "dist"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
```

**Explications :**
- `command` : Commande de build Vite
- `publish` : Dossier de sortie
- `redirects` : SPA routing (toutes les routes ‚Üí index.html)
- `headers` : Cache agressif pour assets avec hash

---

## D√©ploiement initial

### Via Netlify Dashboard

<Steps>
  <Step title="Connecter le repository">
    1. Allez sur [app.netlify.com](https://app.netlify.com)
    2. Cliquez sur **"Add new site"** ‚Üí **"Import an existing project"**
    3. Choisissez votre provider Git (GitHub recommand√©)
    4. S√©lectionnez le repository `kitasso`
  </Step>
  
  <Step title="Configurer le build">
    Netlify d√©tecte automatiquement Vite, mais v√©rifiez :
    
    - **Branch to deploy:** `main`
    - **Build command:** `npm run build`
    - **Publish directory:** `dist`
    - **Node version:** 18 ou sup√©rieur
  </Step>
  
  <Step title="Ajouter les variables d'environnement">
    Dans **Site settings** ‚Üí **Build & deploy** ‚Üí **Environment** :
    
    ```bash
    VITE_SUPABASE_URL=https://xxxxx.supabase.co
    VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    ```
    
    <Warning>
      N'ajoutez JAMAIS la service role key c√¥t√© frontend
    </Warning>
  </Step>
  
  <Step title="D√©ployer">
    Cliquez sur **"Deploy site"**
    
    Netlify va :
    1. Cloner le repository
    2. Installer les d√©pendances (`npm install`)
    3. Ex√©cuter le build (`npm run build`)
    4. Publier le dossier `dist`
    
    ‚è±Ô∏è **Dur√©e :** 2-3 minutes
  </Step>
</Steps>

---

## D√©ploiements automatiques

### Configuration Git

Par d√©faut, Netlify red√©ploie automatiquement sur :
- ‚úÖ Push sur la branche `main`
- ‚úÖ Merge de Pull Request

**Workflow :**
```bash
# 1. D√©veloppement local
git checkout -b feature/ma-feature
# ... modifications ...
git commit -m "feat: nouvelle feature"
git push origin feature/ma-feature

# 2. Pull Request sur GitHub
# ‚Üí Netlify cr√©e un Deploy Preview

# 3. Merge vers main
# ‚Üí D√©ploiement automatique en production
```

---

## Deploy Previews

### Pour chaque Pull Request

Netlify cr√©e automatiquement une URL de preview :

```
https://deploy-preview-42--kitasso.netlify.app
```

**Avantages :**
- Tester avant merge
- Partager avec l'√©quipe
- QA visuel
- Tests E2E sur environnement proche prod

**Dans la PR GitHub :**
- ‚úÖ Statut du build (success/fail)
- üîó Lien vers le deploy preview
- üìä Lighthouse scores

---

## Custom Domain

### Ajouter un domaine personnalis√©

<Steps>
  <Step title="Aller dans Domain settings">
    **Site settings** ‚Üí **Domain management** ‚Üí **Add custom domain**
  </Step>
  
  <Step title="Configurer le DNS">
    Chez votre registrar (OVH, Namecheap, etc.) :
    
    **Option A : Apex domain (kitasso.com)**
    ```
    Type: A
    Name: @
    Value: 75.2.60.5 (IP Netlify)
    ```
    
    **Option B : Subdomain (app.kitasso.com)**
    ```
    Type: CNAME
    Name: app
    Value: kitasso.netlify.app
    ```
  </Step>
  
  <Step title="Activer HTTPS">
    Netlify active automatiquement Let's Encrypt (SSL gratuit)
    
    ‚è±Ô∏è **D√©lai :** 24h max pour propagation DNS
  </Step>
</Steps>

---

## Optimisations Build

### Variables Node

Ajoutez dans les environment variables Netlify :

```bash
NODE_VERSION=18
NPM_FLAGS=--legacy-peer-deps  # Si conflits de d√©pendances
```

### Cache des d√©pendances

Netlify cache automatiquement `node_modules/` entre builds.

**Pour forcer un rebuild complet :**
1. **Site settings** ‚Üí **Build & deploy** ‚Üí **Build settings**
2. Cliquez sur **"Clear cache and deploy site"**

---

## Monitoring & Analytics

### Build Logs

Acc√©dez aux logs complets :
- **Deploys** ‚Üí Cliquez sur un deploy
- Voir **Deploy log**

**Erreurs fr√©quentes :**

```bash
# Erreur : Module not found
‚Üí V√©rifiez les imports (case-sensitive sur Linux)

# Erreur : Out of memory
‚Üí Ajoutez NODE_OPTIONS=--max-old-space-size=4096

# Erreur : Environment variable
‚Üí V√©rifiez VITE_SUPABASE_URL et VITE_SUPABASE_ANON_KEY
```

---

### Netlify Analytics (payant)

Active des analytics serveur-side :
- Visites uniques
- Pages populaires
- Sources de trafic
- Pas de cookies (RGPD-friendly)

**Prix :** ~9$/mois

---

## Performance

### Asset Optimization

Netlify optimise automatiquement :
- ‚úÖ Gzip/Brotli compression
- ‚úÖ HTTP/2 Server Push
- ‚úÖ Global CDN
- ‚úÖ Smart CDN routing

### Headers de cache

Configur√©s dans `netlify.toml` :

```toml
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
```

---

## Rollback

### Revenir √† un d√©ploiement pr√©c√©dent

<Steps>
  <Step title="Aller dans Deploys">
    Liste de tous les d√©ploiements avec timestamps
  </Step>
  
  <Step title="S√©lectionner un deploy">
    Cliquez sur un deploy pr√©c√©dent
  </Step>
  
  <Step title="Publish deploy">
    Cliquez sur **"Publish deploy"**
    
    ‚è±Ô∏è **Instantan√©** : pas de rebuild
  </Step>
</Steps>

<Warning>
  Le rollback ne change PAS votre code Git. Pensez aussi √† revert sur Git si n√©cessaire.
</Warning>

---

## Functions (optionnel)

Netlify Functions permet d'ajouter des endpoints serverless.

### Cr√©er une function

```javascript
// netlify/functions/hello.js
exports.handler = async (event, context) => {
  return {
    statusCode: 200,
    body: JSON.stringify({ message: 'Hello from Netlify!' }),
  };
};
```

**URL :** `https://kitasso.netlify.app/.netlify/functions/hello`

**Use cases :**
- Webhooks Stripe
- Envoi d'emails transactionnels
- Proxy API avec rate limiting

---

## Troubleshooting

### Build √©choue

**V√©rifications :**
1. Build fonctionne localement ? (`npm run build`)
2. Variables d'environnement d√©finies ?
3. Node version compatible ? (18+)
4. Logs d'erreur sp√©cifiques ?

### 404 sur routes

**Cause :** Redirects SPA non configur√©s

**Solution :** V√©rifiez `netlify.toml` :
```toml
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

### Build trop lent

**Optimisations :**
- Utilisez le cache npm
- R√©duisez les d√©pendances dev
- Parall√©lisez avec `npm ci` au lieu de `npm install`

---

## Checklist d√©ploiement

Avant de passer en production :

- [ ] Build local r√©ussi (`npm run build`)
- [ ] Tests passent (`npm test`)
- [ ] Variables d'environnement configur√©es
- [ ] `netlify.toml` pr√©sent avec redirects
- [ ] Custom domain configur√© (optionnel)
- [ ] HTTPS activ√©
- [ ] Analytics configur√© (optionnel)
- [ ] Monitoring en place

---

## Ressources

<CardGroup cols={2}>
  <Card title="Netlify Docs" icon="book" href="https://docs.netlify.com">
    Documentation officielle
  </Card>
  
  <Card title="Supabase Setup" icon="database" href="/deployment/supabase">
    Configuration Supabase
  </Card>
  
  <Card title="Monitoring" icon="chart-line" href="/deployment/monitoring">
    Logs et surveillance
  </Card>
  
  <Card title="Vite Config" icon="bolt" href="https://vitejs.dev/config/">
    Configuration Vite
  </Card>
</CardGroup>